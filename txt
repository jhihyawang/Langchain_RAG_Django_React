import shutil

def pdf_rotation(self):
    # Step 1: è¤‡è£½æª”æ¡ˆåšåˆ¤æ–·èˆ‡æ—‹è½‰
    temp_path = self.pdf_path + ".rotation_check.pdf"
    shutil.copy(self.pdf_path, temp_path)

    log(f"ğŸ“„ è¤‡è£½ PDF æª”æ¡ˆè‡³ï¼š{temp_path} ç”¨æ–¼æ—‹è½‰è™•ç†")

    # æ”¹è®Š self.pdf_path æŒ‡å‘è¤‡è£½çš„æª”æ¡ˆ
    original_path = self.pdf_path
    self.pdf_path = temp_path

    # Step 2: åµæ¸¬æ—‹è½‰é é¢
    rotated_pages = self.correction_direction()
    if not rotated_pages:
        log("âœ… ç„¡éœ€æ—‹è½‰é é¢")
        os.remove(temp_path)  # æ¸…é™¤è¤‡è£½æª”
        self.pdf_path = original_path
        return False

    # Step 3: å°è¤‡è£½æª”æ¡ˆé€²è¡Œæ—‹è½‰
    log(f"ğŸ”„ å°è¤‡è£½æª”æ¡ˆé€²è¡Œæ—‹è½‰ï¼š{temp_path}")
    try:
        doc = fitz.open(temp_path)
        for pg in rotated_pages:
            page = doc[pg - 1]
            page.set_rotation((page.rotation + 90) % 360)

        rotated_output = original_path + ".rotated.pdf"
        doc.save(rotated_output, garbage=4, deflate=True)
        doc.close()

        # Step 4: æ›¿æ›åŸå§‹æª”æ¡ˆ
        os.replace(rotated_output, original_path)
        log(f"âœ… æˆåŠŸæ—‹è½‰ä¸¦æ›´æ–°åŸå§‹æª”æ¡ˆï¼š{original_path}")
    except Exception as e:
        log(f"âŒ æ—‹è½‰éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
    finally:
        # ç¸½æ˜¯æ¸…é™¤æš«å­˜æª”
        if os.path.exists(temp_path):
            os.remove(temp_path)
        self.pdf_path = original_path

    return True
